<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CHASTE DRAGON EVENT SYSTEM</title>

<!-- FIREBASE V8 (STABLE) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#000,#111,#1a1a1a);
  color:white;
  text-align:center;
}
header{
  padding:20px;
  background:black;
  border-bottom:2px solid gold;
}
h1{color:gold;}
.container{
  max-width:600px;
  margin:auto;
  padding:20px;
}
.card{
  background:#111;
  padding:20px;
  border-radius:12px;
  border:1px solid gold;
  margin-top:20px;
}
input{
  width:95%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}
button{
  padding:10px 15px;
  margin:5px;
  border:none;
  border-radius:8px;
  background:gold;
  font-weight:bold;
  cursor:pointer;
}
button:hover{background:orange;}
.badge{
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}
.verified{background:green;}
.unverified{background:red;}
.admin{display:none;}
.listItem{
  margin:8px 0;
  padding:8px;
  border-bottom:1px solid #333;
}
.counter{
  font-size:18px;
  margin-bottom:10px;
  color:gold;
}
</style>
</head>
<body>

<header>
<h1>CHASTE DRAGON LEADER</h1>
<p>Event Receh & Verified Badge System</p>
</header>

<div class="container">

<div class="card">
<h3>Join Event Receh</h3>

<input type="text" id="eventAkun" placeholder="Nama Akun Walla">
<input type="text" id="eventLink" placeholder="Link Akun Walla">
<input type="text" id="eventNamaAsli" placeholder="Nama Asli">
<input type="text" id="eventPhone" placeholder="Nomor WhatsApp (+62xxx)">

<button id="joinBtn" onclick="joinEvent()">JOIN EVENT</button>
</div>

<div class="card">
<h3>Peserta Event</h3>
<div class="counter">Total Peserta: <span id="totalPeserta">0</span></div>
<div id="eventList"></div>
</div>

<div class="card">
<h3>Admin Login</h3>
<input type="password" id="adminPass" placeholder="Password Admin">
<button onclick="adminLogin()">Login</button>
</div>

<div class="card admin" id="adminPanel">
<h3>Admin Panel - Verifikasi</h3>
<div id="adminList"></div>
</div>

</div>

<script>

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyAx63q_PnqWj34c5zxH9aZcwUjKHWAsaYA",
  authDomain: "chastedragon.firebaseapp.com",
  projectId: "chastedragon"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* CEK STATUS SAAT LOAD */
window.addEventListener("load", ()=>{
  checkJoinStatus();
});

/* CEK LOCAL STORAGE */
function checkJoinStatus(){
  const phone = localStorage.getItem("eventPhone");
  if(!phone) return;

  db.collection("eventReceh")
    .where("phone","==",phone)
    .get()
    .then(snapshot=>{
      if(!snapshot.empty){
        const btn = document.getElementById("joinBtn");
        btn.innerText="✔ SUDAH TERDAFTAR";
        btn.disabled=true;
        btn.style.background="green";
      }
    });
}

/* JOIN EVENT */
function joinEvent(){

  const akun = document.getElementById("eventAkun").value.trim();
  const link = document.getElementById("eventLink").value.trim();
  const namaAsli = document.getElementById("eventNamaAsli").value.trim();
  const phone = document.getElementById("eventPhone").value.trim();

  if(!akun || !link || !namaAsli || !phone){
    alert("Lengkapi semua data!");
    return;
  }

  db.collection("eventReceh")
    .where("phone","==",phone)
    .get()
    .then(snapshot=>{

      if(!snapshot.empty){
        alert("Nomor sudah terdaftar!");
        return;
      }

      db.collection("eventReceh").add({
        akun,
        link,
        namaAsli,
        phone,
        verified:false,
        created:firebase.firestore.FieldValue.serverTimestamp()
      });

      localStorage.setItem("eventPhone", phone);

      const btn = document.getElementById("joinBtn");
      btn.innerText="✔ SUDAH TERDAFTAR";
      btn.disabled=true;
      btn.style.background="green";

      alert("Berhasil join event!");
    });
}

/* REALTIME LIST */
db.collection("eventReceh")
.orderBy("created","desc")
.onSnapshot(snapshot=>{
  let html="";
  let total=0;

  snapshot.forEach(doc=>{
    total++;
    let d=doc.data();

    html+=`
    <div class="listItem">
      <b>${d.akun}</b>
      <span class="badge ${d.verified?'verified':'unverified'}">
      ${d.verified?'✔ Verified':'Belum Verified'}
      </span>
    </div>
    `;
  });

  document.getElementById("eventList").innerHTML=html;
  document.getElementById("totalPeserta").innerText=total;
});

/* ADMIN */
const ADMIN_PASS="chaste2026";

function adminLogin(){
  let pass=document.getElementById("adminPass").value;
  if(pass===ADMIN_PASS){
    document.getElementById("adminPanel").style.display="block";
    loadAdmin();
  }else{
    alert("Password salah!");
  }
}

function loadAdmin(){
  db.collection("eventReceh").onSnapshot(snapshot=>{
    let html="";
    snapshot.forEach(doc=>{
      let d=doc.data();
      html+=`
      <div style="border-bottom:1px solid #333;padding:8px;">
        <b>${d.akun}</b><br>
        ${d.namaAsli}<br>
        ${d.phone}<br>
        ${d.verified?'✔ Verified':'Belum Verified'}
        ${!d.verified?`<button onclick="verifyMember('${doc.id}')">Verify</button>`:''}
      </div>
      `;
    });
    document.getElementById("adminList").innerHTML=html;
  });
}

function verifyMember(id){
  db.collection("eventReceh").doc(id).update({
    verified:true
  });
}

</script>

</body>
</html>