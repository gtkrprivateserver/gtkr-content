<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Ramadhan Puasa - CHASTE DRAGON</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:black;
  color:white;
  font-family:Poppins, sans-serif;
  padding:30px;
  text-align:center;
}
h1, h2 { color:gold; }
select {
  padding:10px;
  border-radius:8px;
  border:none;
  margin-bottom:15px;
  font-size:16px;
}
.card {
  background:#111;
  border:2px solid gold;
  border-radius:15px;
  padding:25px;
  max-width:700px;
  margin:auto;
  box-shadow:0 0 25px gold;
}
.countdown {
  display:flex;
  justify-content:center;
  gap:15px;
  margin-top:20px;
}
.box {
  background:black;
  border:2px solid gold;
  padding:15px 20px;
  border-radius:10px;
  min-width:80px;
}
.number {
  color:gold;
  font-size:26px;
  font-weight:bold;
}
.label { font-size:14px; }
.status { margin-top:15px; font-size:18px; color:gold; }
</style>
</head>

<body>

<h1>üåô RAMADHAN 1447H</h1>
<h2>CHASTE DRAGON Ê¥ÅÈæô</h2>

<label for="cityPicker">Pilih Kota:</label><br>
<select id="cityPicker">
  <option value="-6.2088,106.8456">Jakarta</option>
  <option value="-7.2575,112.7521">Surabaya</option>
  <option value="-6.9175,107.6191">Bandung</option>
  <option value="3.5970,98.6785">Medan</option>
  <option value="-5.1477,119.4327">Makassar</option>
  <option value="-7.7956,110.3695">Yogyakarta</option>
  <option value="-6.9667,110.4167">Semarang</option>
  <option value="-2.9909,104.7560">Palembang</option>
  <option value="-3.3191,114.5901">Banjarmasin</option>
  <option value="-8.6500,115.2167">Denpasar</option>
</select>

<div class="card">
  <div id="jadwalInfo" class="status">Ambil jadwal...</div>

  <div class="countdown">
    <div class="box">
      <div class="number" id="jam">0</div><div class="label">Jam</div>
    </div>
    <div class="box">
      <div class="number" id="menit">0</div><div class="label">Menit</div>
    </div>
    <div class="box">
      <div class="number" id="detik">0</div><div class="label">Detik</div>
    </div>
  </div>
</div>

<script>

let jadwalImsak = "";
let jadwalMaghrib = "";

// Ambil data dari API Aladhan
function fetchJadwal(lat, lon) {
  document.getElementById("jadwalInfo").innerText = "Mengambil jadwal berdasarkan lokasi...";
  fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=11`)
    .then(res => res.json())
    .then(res => {
      jadwalImsak = res.data.timings.Imsak.split(" ")[0];     // hh:mm
      jadwalMaghrib = res.data.timings.Maghrib.split(" ")[0]; // hh:mm
      document.getElementById("jadwalInfo").innerHTML =
        `üïå Imsak: ${jadwalImsak} | üåá Maghrib: ${jadwalMaghrib}`;
      startCountdown();
    })
    .catch(err => {
      document.getElementById("jadwalInfo").innerText = "Gagal mengambil jadwal";
      console.error(err);
    });
}

// Hitung target waktu
function getTargetTime() {
  const now = new Date();
  const today = now.toDateString();

  const [ih, im] = jadwalImsak.split(":");
  const [mh, mm] = jadwalMaghrib.split(":");

  const imsak = new Date(today + " " + ih + ":" + im + ":00").getTime();
  const maghrib = new Date(today + " " + mh + ":" + mm + ":00").getTime();

  if (now < maghrib && now >= imsak) {
    return { status: "Menuju Berbuka Puasa", target: maghrib };
  } else {
    if (now >= maghrib) {
      // menuju imsak besok
      return { status: "Menuju Imsak (Sahur)", target: new Date(today + " " + ih + ":" + im + ":00").getTime() + 86400000 };
    } else {
      // sebelum imsak
      return { status: "Menuju Imsak (Sahur)", target: imsak };
    }
  }
}

function startCountdown(){
  setInterval(() => {
    const now = new Date().getTime();
    const targetData = getTargetTime();

    const diff = targetData.target - now;

    const jam = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000*60*60));
    const menit = Math.floor((diff % (1000*60*60)) / (1000*60));
    const detik = Math.floor((diff % (1000*60)) / 1000);

    document.getElementById("jadwalInfo").innerText = targetData.status;
    document.getElementById("jam").innerText = jam;
    document.getElementById("menit").innerText = menit;
    document.getElementById("detik").innerText = detik;

  }, 1000);
}

// Ketika pilih kota
document.getElementById("cityPicker").addEventListener("change", function(){
  const [lat, lon] = this.value.split(",");
  fetchJadwal(lat, lon);
});

// Set awal (default Jakarta)
const init = document.getElementById("cityPicker").value.split(",");
fetchJadwal(init[0], init[1]);

</script>

</body>
</html>