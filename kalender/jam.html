<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ramadhan PRO - CHASTE DRAGON</title>

<style>
body{
  background:black;
  color:white;
  font-family:Poppins, sans-serif;
  text-align:center;
  padding:40px;
}

h1{color:gold;}

.card{
  background:#111;
  border:2px solid gold;
  border-radius:20px;
  padding:30px;
  max-width:650px;
  margin:auto;
  box-shadow:0 0 30px gold;
}

.status{
  font-size:22px;
  color:gold;
  font-weight:bold;
  margin-bottom:20px;
}

.countdown{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-top:20px;
}

.box{
  border:2px solid gold;
  padding:15px;
  border-radius:12px;
  min-width:90px;
}

.number{
  font-size:28px;
  font-weight:bold;
  color:gold;
}

.label{
  font-size:14px;
}

.info{
  margin-top:20px;
  font-size:14px;
  color:#ccc;
}
</style>
</head>

<body>

<h1>üåô RAMADHAN PRO SYSTEM</h1>
<h2>CHASTE DRAGON Ê¥ÅÈæô</h2>

<div class="card">
  <div class="status" id="statusText">Mendeteksi lokasi...</div>

  <div class="countdown">
    <div class="box">
      <div class="number" id="jam">0</div>
      <div class="label">Jam</div>
    </div>
    <div class="box">
      <div class="number" id="menit">0</div>
      <div class="label">Menit</div>
    </div>
    <div class="box">
      <div class="number" id="detik">0</div>
      <div class="label">Detik</div>
    </div>
  </div>

  <div class="info" id="jadwalInfo"></div>
</div>

<audio id="adzanSound">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_8b8a7a33d5.mp3" type="audio/mpeg">
</audio>

<script>

let imsakTime, maghribTime;
let adzanPlayed = false;

// ==========================
// GET LOCATION
// ==========================
navigator.geolocation.getCurrentPosition(position => {

  const lat = position.coords.latitude;
  const lon = position.coords.longitude;

  // API Aladhan
  fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=11`)
  .then(res => res.json())
  .then(data => {

    const timings = data.data.timings;

    imsakTime = timings.Imsak;
    maghribTime = timings.Maghrib;

    document.getElementById("jadwalInfo").innerHTML =
      `üïå Imsak: ${imsakTime} | üåá Maghrib: ${maghribTime}`;

    startSystem();

  });

}, () => {
  alert("Aktifkan GPS untuk mendapatkan jadwal otomatis.");
});

function getTodayTime(timeStr, plusDay = 0){
  const now = new Date();
  const [h,m] = timeStr.split(":");
  return new Date(
    now.getFullYear(),
    now.getMonth(),
    now.getDate() + plusDay,
    h,m,0
  ).getTime();
}

function startSystem(){

  setInterval(() => {

    const now = new Date().getTime();
    const imsakToday = getTodayTime(imsakTime);
    const maghribToday = getTodayTime(maghribTime);

    let target;
    let statusText;

    if(now < maghribToday){
      target = maghribToday;
      statusText = "‚è≥ Menuju Berbuka Puasa";
    } else {
      target = getTodayTime(imsakTime,1);
      statusText = "üåô Menuju Imsak (Sahur)";
      adzanPlayed = false;
    }

    const diff = target - now;

    if(now >= maghribToday && !adzanPlayed){
      document.getElementById("adzanSound").play();
      alert("üåá Waktu Berbuka Puasa Telah Tiba!");
      adzanPlayed = true;
    }

    const jam = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
    const menit = Math.floor((diff % (1000*60*60)) / (1000*60));
    const detik = Math.floor((diff % (1000*60)) / 1000);

    document.getElementById("statusText").innerText = statusText;
    document.getElementById("jam").innerText = jam;
    document.getElementById("menit").innerText = menit;
    document.getElementById("detik").innerText = detik;

  },1000);

}

</script>
<hr style="border:1px solid gold;margin:40px 0;">

<div class="footer">
<a href="kalender.html" style="color:gold;text-decoration:none;">
‚¨Ö Kembali</a>
</body>
</html>